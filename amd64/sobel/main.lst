     1                                 %line 1+1 main.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 [extern printf]
    19                                 
    20                                 [global apply_sobel]
    21                                 
    22                                 
    23                                 [section .data]
    24 00000000 00000000000024C000-     sobel: dq -1.0e1, -2.0e1, -1.0e1
    25 00000000 000000000034C00000-
    26 00000000 0000000024C0       
    27 00000018 000000000000000000-     sobelr1: dq 0.0e1, 0.0e1, 0.0e1
    28 00000018 000000000000000000-
    29 00000018 000000000000       
    30 00000030 000000000000244000-     sobelr2: dq 1.0e1, 2.0e1, 1.0e1
    31 00000030 000000000034400000-
    32 00000030 000000002440       
    33                                 
    34 00000048 25700A25700A25700A-     print_ptr_format: db "%p", 0xA, "%p", 0xA, "%p", 0xA, 0x0
    35 00000048 00                 
    36 00000052 59203D2025642C2058-     print_int: db "Y = %d, X = %d", 0xA, 0x0
    37 00000052 203D2025640A00     
    38 00000062 48203D2025642C2057-     image_size_fmt: db "H = %d, W = %d", 0xA, 0x0
    39 00000062 203D2025640A00     
    40 00000072 5074723A2025700A00      print_pointer: db "Ptr: %p", 0xA, 0x0
    41                                 
    42                                 [section .text]
    43                                 apply_sobel:
    44                                 
    45 00000000 55                      push rbp
    46 00000001 4889E5                  mov rbp, rsp
    47 00000004 4883EC48                sub rsp, 72
    48                                 
    49                                 
    50                                 
    51                                 
    52                                 
    53                                 
    54                                 
    55                                 
    56                                 
    57                                 
    58 00000008 57                      push rdi
    59                                 
    60 00000009 E81E010000              call print_pointer_subroutine
    61 0000000E 5F                      pop rdi
    62                                 
    63                                 
    64 0000000F 56                      push rsi
    65 00000010 4889F7                  mov rdi, rsi
    66 00000013 E814010000              call print_pointer_subroutine
    67 00000018 5E                      pop rsi
    68                                 
    69                                 
    70 00000019 4883FA03                cmp rdx, 3
    71 0000001D 0F8C00010000            jl clean_and_return
    72 00000023 4883F903                cmp rcx, 3
    73 00000027 0F8CF6000000            jl clean_and_return
    74                                 
    75                                 
    76                                 
    77 0000002D 4883EA02                sub rdx, 2
    78 00000031 4883E902                sub rcx, 2
    79 00000035 48C1E103                shl rcx, 3
    80                                 
    81                                 
    82                                 
    83 00000039 4D31C0                  xor r8, r8
    84                                 
    85                                 
    86                                 
    87                                 
    88                                  outer_loop:
    89                                 
    90 0000003C 4D31C9                  xor r9, r9
    91                                 
    92                                  inner_loop:
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98 0000003F F20F5CC0                subsd xmm0, xmm0
    99                                 
   100 00000043 4D89C2                  mov r10, r8
   101 00000046 4C0FAFD1                imul r10, rcx
   102 0000004A 4D01CA                  add r10, r9
   103 0000004D 4901FA                  add r10, rdi
   104                                 
   105 00000050 F20F100C25[00000000]      movsd xmm1, QWORD [sobel]
   106 00000059 F2410F590A              mulsd xmm1, QWORD [r10]
   107 0000005E F20F58C1                addsd xmm0, xmm1
   108                                 
   109                                 
   110                                 
   111 00000062 F20F100C25[00000000]      movsd xmm1, QWORD [sobel + 0]
   112 0000006B F2410F590A              mulsd xmm1, QWORD [r10 + 0]
   113 00000070 F20F58C1                addsd xmm0, xmm1
   114                                 
   115 00000074 F20F100C25[08000000]      movsd xmm1, QWORD [sobel + 8]
   116 0000007D F2410F594A08            mulsd xmm1, QWORD [r10 + 8]
   117 00000083 F20F58C1                addsd xmm0, xmm1
   118                                 
   119 00000087 F20F100C25[10000000]      movsd xmm1, QWORD [sobel + 16]
   120 00000090 F2410F594A10            mulsd xmm1, QWORD [r10 + 16]
   121 00000096 F20F58C1                addsd xmm0, xmm1
   122                                 
   123 0000009A 4901CA                  add r10, rcx
   124                                 
   125 0000009D F20F100C25[18000000]      movsd xmm1, QWORD [sobel + 24]
   126 000000A6 F2410F590A              mulsd xmm1, QWORD [r10 + 0]
   127 000000AB F20F58C1                addsd xmm0, xmm1
   128                                 
   129 000000AF F20F100C25[20000000]      movsd xmm1, QWORD [sobel + 32]
   130 000000B8 F2410F594A08            mulsd xmm1, QWORD [r10 + 8]
   131 000000BE F20F58C1                addsd xmm0, xmm1
   132                                 
   133 000000C2 F20F100C25[28000000]      movsd xmm1, QWORD [sobel + 40]
   134 000000CB F2410F594A10            mulsd xmm1, QWORD [r10 + 16]
   135 000000D1 F20F58C1                addsd xmm0, xmm1
   136                                 
   137 000000D5 4901CA                  add r10, rcx
   138                                 
   139 000000D8 F20F100C25[30000000]      movsd xmm1, QWORD [sobel + 48]
   140 000000E1 F2410F590A              mulsd xmm1, QWORD [r10 + 0]
   141 000000E6 F20F58C1                addsd xmm0, xmm1
   142                                 
   143 000000EA F20F100C25[38000000]      movsd xmm1, QWORD [sobel + 56]
   144 000000F3 F2410F594A08            mulsd xmm1, QWORD [r10 + 8]
   145 000000F9 F20F58C1                addsd xmm0, xmm1
   146                                 
   147 000000FD F20F100C25[40000000]      movsd xmm1, QWORD [sobel + 64]
   148 00000106 F2410F594A10            mulsd xmm1, QWORD [r10 + 16]
   149 0000010C F20F58C1                addsd xmm0, xmm1
   150                                 
   151                                 
   152                                 
   153                                 
   154                                 
   155                                 
   156                                 
   157 00000110 4983C108                add r9, 8
   158 00000114 4939C9                  cmp r9, rcx
   159 00000117 0F8C1CFFFFFF            jl inner_loop
   160                                 
   161                                 
   162 0000011D 49FFC0                  inc r8
   163 00000120 4C39C2                  cmp rdx, r8
   164 00000123 0F850DFFFFFF            jne outer_loop
   165                                 
   166                                  clean_and_return:
   167                                 
   168 00000129 4883C448                add rsp, 72
   169 0000012D 5D                      pop rbp
   170 0000012E C3                      ret
   171                                 
   172                                 
   173                                  invalid_image_size:
   174 0000012F EBF6                    jmp clean_and_return
   175                                 
   176                                  print_pointer_subroutine:
   177 00000131 55                      push rbp
   178 00000132 4889E5                  mov rbp, rsp
   179 00000135 4883EC50                sub rsp, 80
   180                                 
   181 00000139 48897C2408              mov [rsp+8], rdi
   182 0000013E 4889742410              mov [rsp+16], rsi
   183 00000143 4889542418              mov [rsp+24], rdx
   184 00000148 48894C2420              mov [rsp+32], rcx
   185 0000014D 4C89442428              mov [rsp+40], r8
   186 00000152 4C894C2430              mov [rsp+48], r9
   187 00000157 4C89542438              mov [rsp+56], r10
   188 0000015C 4C895C2440              mov [rsp+64], r11
   189                                 
   190 00000161 48C7C7[00000000]        mov rdi, print_pointer
   191 00000168 488B742408              mov rsi, [rsp+8]
   192 0000016D E8(F6FFFFFF)            call printf
   193                                 
   194 00000172 488B7C2408              mov rdi, [rsp+8]
   195 00000177 488B742410              mov rsi, [rsp+16]
   196 0000017C 488B542418              mov rdx, [rsp+24]
   197 00000181 488B4C2420              mov rcx, [rsp+32]
   198 00000186 4C8B442428              mov r8, [rsp+40]
   199 0000018B 4C8B4C2430              mov r9, [rsp+48]
   200 00000190 4C8B542438              mov r10, [rsp+56]
   201 00000195 4C8B5C2440              mov r11, [rsp+64]
   202                                 
   203 0000019A 4883C450                add rsp, 80
   204 0000019E 5D                      pop rbp
   205 0000019F C3                      ret
   206                                 
   207                                 
   208                                 
   209                                 
   210                                 
   211                                 
   212                                 
