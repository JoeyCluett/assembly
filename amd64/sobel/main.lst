     1                                 %line 1+1 main.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 [extern printf]
    19                                 
    20                                 [global apply_sobel]
    21                                 
    22                                 
    23                                 [section .data]
    24 00000000 000000000000F0BF00-     sobel: dq -1.0, -2.0, -1.0
    25 00000000 000000000000C00000-
    26 00000000 00000000F0BF       
    27 00000018 000000000000000000-     sobelr1: dq 0.0, 0.0, 0.0
    28 00000018 000000000000000000-
    29 00000018 000000000000       
    30 00000030 000000000000F03F00-     sobelr2: dq 1.0, 2.0, 1.0
    31 00000030 000000000000400000-
    32 00000030 00000000F03F       
    33                                 
    34 00000048 000000000000F03F        const_zero: dq 1.0
    35                                 
    36 00000050 25700A25700A25700A-     print_ptr_format: db "%p", 0xA, "%p", 0xA, "%p", 0xA, 0x0
    37 00000050 00                 
    38 0000005A 59203D2025642C2058-     print_int: db "Y = %d, X = %d", 0xA, 0x0
    39 0000005A 203D2025640A00     
    40 0000006A 48203D2025642C2057-     image_size_fmt: db "H = %d, W = %d", 0xA, 0x0
    41 0000006A 203D2025640A00     
    42 0000007A 5074723A2025700A00      print_pointer: db "Ptr: %p", 0xA, 0x0
    43 00000083 256C662000              print_double: db "%lf ", 0x0
    44 00000088 256C660A00              print_double_ln: db "%lf", 0xA, 0x0
    45 0000008D 0A00                    print_ln: db 0xA, 0x0
    46                                 
    47                                 [section .text]
    48                                 apply_sobel:
    49                                 
    50 00000000 55                      push rbp
    51 00000001 4889E5                  mov rbp, rsp
    52 00000004 4883EC48                sub rsp, 72
    53                                 
    54                                 
    55                                 
    56                                 
    57                                 
    58                                 
    59                                 
    60                                 
    61                                 
    62                                 
    63 00000008 57                      push rdi
    64                                 
    65 00000009 E83F030000              call print_pointer_subroutine
    66 0000000E 5F                      pop rdi
    67                                 
    68                                 
    69 0000000F 57                      push rdi
    70 00000010 4889F7                  mov rdi, rsi
    71 00000013 E835030000              call print_pointer_subroutine
    72 00000018 5F                      pop rdi
    73                                 
    74                                 
    75 00000019 4883FA03                cmp rdx, 3
    76 0000001D 0F8C35020000            jl clean_and_return
    77 00000023 4883F903                cmp rcx, 3
    78 00000027 0F8C2B020000            jl clean_and_return
    79                                 
    80                                 
    81                                 
    82 0000002D 4883EA02                sub rdx, 2
    83 00000031 4883E902                sub rcx, 2
    84 00000035 48C1E103                shl rcx, 3
    85                                 
    86                                 
    87                                 
    88 00000039 4D31C0                  xor r8, r8
    89                                 
    90                                 
    91                                 
    92 0000003C 4883EC08                sub rsp, 8
    93 00000040 F20F11442408            movsd [rsp+8], xmm0
    94 00000046 F20F1007                movsd xmm0, [rdi]
    95 0000004A E888020000              call print_double_subroutine
    96 0000004F F20F10442408            movsd xmm0, [rsp+8]
    97 00000055 4883C408                add rsp, 8
    98                                 
    99 00000059 57                      push rdi
   100 0000005A E802020000              call print_newline
   101 0000005F 5F                      pop rdi
   102                                 
   103                                  outer_loop:
   104                                 
   105 00000060 4D31C9                  xor r9, r9
   106                                 
   107                                  inner_loop:
   108                                 
   109                                 
   110                                 
   111                                 
   112                                 
   113                                 
   114 00000063 F20F100425[00000000]      movsd xmm0, [const_zero]
   115                                 
   116                                 
   117                                 
   118                                 
   119                                 
   120                                 
   121 0000006C 4989FA                  mov r10, rdi
   122                                 
   123                                 
   124                                 
   125                                 
   126                                 
   127                                 
   128                                 
   129 0000006F F20F100C25[00000000]      movsd xmm1, QWORD [sobel + 0]
   130 00000078 F2410F100A              movsd xmm1, QWORD [r10 + 0]
   131 0000007D F20F58C1                addsd xmm0, xmm1
   132                                 
   133 00000081 4883EC08                sub rsp, 8
   134 00000085 F20F11442408            movsd [rsp+8], xmm0
   135 0000008B F20F10C1                movsd xmm0, xmm1
   136 0000008F E843020000              call print_double_subroutine
   137 00000094 F20F10442408            movsd xmm0, [rsp+8]
   138 0000009A 4883C408                add rsp, 8
   139                                 
   140 0000009E F20F100C25[08000000]      movsd xmm1, QWORD [sobel + 8]
   141 000000A7 F2410F104A08            movsd xmm1, QWORD [r10 + 8]
   142 000000AD F20F58C1                addsd xmm0, xmm1
   143                                 
   144 000000B1 4883EC08                sub rsp, 8
   145 000000B5 F20F11442408            movsd [rsp+8], xmm0
   146 000000BB F20F10C1                movsd xmm0, xmm1
   147 000000BF E813020000              call print_double_subroutine
   148 000000C4 F20F10442408            movsd xmm0, [rsp+8]
   149 000000CA 4883C408                add rsp, 8
   150                                 
   151 000000CE F20F100C25[10000000]      movsd xmm1, QWORD [sobel + 16]
   152 000000D7 F2410F104A10            movsd xmm1, QWORD [r10 + 16]
   153 000000DD F20F58C1                addsd xmm0, xmm1
   154                                 
   155 000000E1 4883EC08                sub rsp, 8
   156 000000E5 F20F11442408            movsd [rsp+8], xmm0
   157 000000EB F20F10C1                movsd xmm0, xmm1
   158 000000EF E8E3010000              call print_double_subroutine
   159 000000F4 F20F10442408            movsd xmm0, [rsp+8]
   160 000000FA 4883C408                add rsp, 8
   161                                 
   162 000000FE 4901CA                  add r10, rcx
   163                                 
   164 00000101 F20F100C25[18000000]      movsd xmm1, QWORD [sobel + 24]
   165 0000010A F2410F100A              movsd xmm1, QWORD [r10 + 0]
   166 0000010F F20F58C1                addsd xmm0, xmm1
   167                                 
   168 00000113 4883EC08                sub rsp, 8
   169 00000117 F20F11442408            movsd [rsp+8], xmm0
   170 0000011D F20F10C1                movsd xmm0, xmm1
   171 00000121 E8B1010000              call print_double_subroutine
   172 00000126 F20F10442408            movsd xmm0, [rsp+8]
   173 0000012C 4883C408                add rsp, 8
   174                                 
   175 00000130 F20F100C25[20000000]      movsd xmm1, QWORD [sobel + 32]
   176 00000139 F2410F104A08            movsd xmm1, QWORD [r10 + 8]
   177 0000013F F20F58C1                addsd xmm0, xmm1
   178                                 
   179 00000143 4883EC08                sub rsp, 8
   180 00000147 F20F11442408            movsd [rsp+8], xmm0
   181 0000014D F20F10C1                movsd xmm0, xmm1
   182 00000151 E881010000              call print_double_subroutine
   183 00000156 F20F10442408            movsd xmm0, [rsp+8]
   184 0000015C 4883C408                add rsp, 8
   185                                 
   186 00000160 F20F100C25[28000000]      movsd xmm1, QWORD [sobel + 40]
   187 00000169 F2410F104A10            movsd xmm1, QWORD [r10 + 16]
   188 0000016F F20F58C1                addsd xmm0, xmm1
   189                                 
   190 00000173 4883EC08                sub rsp, 8
   191 00000177 F20F11442408            movsd [rsp+8], xmm0
   192 0000017D F20F10C1                movsd xmm0, xmm1
   193 00000181 E851010000              call print_double_subroutine
   194 00000186 F20F10442408            movsd xmm0, [rsp+8]
   195 0000018C 4883C408                add rsp, 8
   196                                 
   197 00000190 4901CA                  add r10, rcx
   198                                 
   199 00000193 F20F100C25[30000000]      movsd xmm1, QWORD [sobel + 48]
   200 0000019C F2410F100A              movsd xmm1, QWORD [r10 + 0]
   201 000001A1 F20F58C1                addsd xmm0, xmm1
   202                                 
   203 000001A5 4883EC08                sub rsp, 8
   204 000001A9 F20F11442408            movsd [rsp+8], xmm0
   205 000001AF F20F10C1                movsd xmm0, xmm1
   206 000001B3 E81F010000              call print_double_subroutine
   207 000001B8 F20F10442408            movsd xmm0, [rsp+8]
   208 000001BE 4883C408                add rsp, 8
   209                                 
   210 000001C2 F20F100C25[38000000]      movsd xmm1, QWORD [sobel + 56]
   211 000001CB F2410F104A08            movsd xmm1, QWORD [r10 + 8]
   212 000001D1 F20F58C1                addsd xmm0, xmm1
   213                                 
   214 000001D5 4883EC08                sub rsp, 8
   215 000001D9 F20F11442408            movsd [rsp+8], xmm0
   216 000001DF F20F10C1                movsd xmm0, xmm1
   217 000001E3 E8EF000000              call print_double_subroutine
   218 000001E8 F20F10442408            movsd xmm0, [rsp+8]
   219 000001EE 4883C408                add rsp, 8
   220                                 
   221 000001F2 F20F100C25[40000000]      movsd xmm1, QWORD [sobel + 64]
   222 000001FB F2410F104A10            movsd xmm1, QWORD [r10 + 16]
   223 00000201 F20F58C1                addsd xmm0, xmm1
   224                                 
   225 00000205 4883EC08                sub rsp, 8
   226 00000209 F20F11442408            movsd [rsp+8], xmm0
   227 0000020F F20F10C1                movsd xmm0, xmm1
   228 00000213 E8BF000000              call print_double_subroutine
   229 00000218 F20F10442408            movsd xmm0, [rsp+8]
   230 0000021E 4883C408                add rsp, 8
   231                                 
   232                                 
   233 00000222 4929CA                  sub r10, rcx
   234 00000225 4929FA                  sub r10, rdi
   235 00000228 4901F2                  add r10, rsi
   236 0000022B 4983C208                add r10, 8
   237 0000022F F2410F1102              movsd [r10], xmm0
   238                                 
   239 00000234 57                      push rdi
   240 00000235 E827000000              call print_newline
   241 0000023A 5F                      pop rdi
   242                                 
   243                                 
   244 0000023B 4983C108                add r9, 8
   245 0000023F 4939C9                  cmp r9, rcx
   246 00000242 0F8C15FEFFFF            jl inner_loop
   247                                 
   248 00000248 57                      push rdi
   249 00000249 E813000000              call print_newline
   250 0000024E 5F                      pop rdi
   251                                 
   252                                 
   253 0000024F 4801CF                  add rdi, rcx
   254                                 
   255                                 
   256 00000252 49FFC0                  inc r8
   257 00000255 4C39C2                  cmp rdx, r8
   258 00000258 0F85FCFDFFFF            jne outer_loop
   259                                 
   260                                  clean_and_return:
   261                                 
   262 0000025E 4883C448                add rsp, 72
   263 00000262 5D                      pop rbp
   264 00000263 C3                      ret
   265                                 
   266                                 
   267                                  invalid_image_size:
   268 00000264 EBF6                    jmp clean_and_return
   269                                 
   270                                  print_newline:
   271 00000266 55                      push rbp
   272 00000267 4889E5                  mov rbp, rsp
   273 0000026A 4883EC60                sub rsp, 96
   274                                 
   275 0000026E 48897C2408              mov [rsp+8], rdi
   276 00000273 4889742410              mov [rsp+16], rsi
   277 00000278 4889542418              mov [rsp+24], rdx
   278 0000027D 48894C2420              mov [rsp+32], rcx
   279 00000282 4C89442428              mov [rsp+40], r8
   280 00000287 4C894C2430              mov [rsp+48], r9
   281 0000028C 4C89542438              mov [rsp+56], r10
   282 00000291 4C895C2440              mov [rsp+64], r11
   283 00000296 F20F11442448            movsd [rsp+72], xmm0
   284                                 
   285 0000029C 48C7C7[00000000]        mov rdi, print_ln
   286 000002A3 E8(F6FFFFFF)            call printf
   287                                 
   288 000002A8 488B7C2408              mov rdi, [rsp+8]
   289 000002AD 488B742410              mov rsi, [rsp+16]
   290 000002B2 488B542418              mov rdx, [rsp+24]
   291 000002B7 488B4C2420              mov rcx, [rsp+32]
   292 000002BC 4C8B442428              mov r8, [rsp+40]
   293 000002C1 4C8B4C2430              mov r9, [rsp+48]
   294 000002C6 4C8B542438              mov r10, [rsp+56]
   295 000002CB 4C8B5C2440              mov r11, [rsp+64]
   296 000002D0 F20F10442448            movsd xmm0, [rsp+72]
   297                                 
   298 000002D6 4883C460                add rsp, 96
   299 000002DA 5D                      pop rbp
   300 000002DB C3                      ret
   301                                 
   302                                  print_double_subroutine:
   303 000002DC 55                      push rbp
   304 000002DD 4889E5                  mov rbp, rsp
   305 000002E0 4883EC60                sub rsp, 96
   306                                 
   307 000002E4 48897C2408              mov [rsp+8], rdi
   308 000002E9 4889742410              mov [rsp+16], rsi
   309 000002EE 4889542418              mov [rsp+24], rdx
   310 000002F3 48894C2420              mov [rsp+32], rcx
   311 000002F8 4C89442428              mov [rsp+40], r8
   312 000002FD 4C894C2430              mov [rsp+48], r9
   313 00000302 4C89542438              mov [rsp+56], r10
   314 00000307 4C895C2440              mov [rsp+64], r11
   315 0000030C F20F11442448            movsd [rsp+72], xmm0
   316                                 
   317 00000312 48C7C7[00000000]        mov rdi, print_double
   318 00000319 E8(F6FFFFFF)            call printf
   319                                 
   320 0000031E 488B7C2408              mov rdi, [rsp+8]
   321 00000323 488B742410              mov rsi, [rsp+16]
   322 00000328 488B542418              mov rdx, [rsp+24]
   323 0000032D 488B4C2420              mov rcx, [rsp+32]
   324 00000332 4C8B442428              mov r8, [rsp+40]
   325 00000337 4C8B4C2430              mov r9, [rsp+48]
   326 0000033C 4C8B542438              mov r10, [rsp+56]
   327 00000341 4C8B5C2440              mov r11, [rsp+64]
   328 00000346 F20F10442448            movsd xmm0, [rsp+72]
   329                                 
   330 0000034C 4883C460                add rsp, 96
   331 00000350 5D                      pop rbp
   332 00000351 C3                      ret
   333                                 
   334                                  print_pointer_subroutine:
   335 00000352 55                      push rbp
   336 00000353 4889E5                  mov rbp, rsp
   337 00000356 4883EC50                sub rsp, 80
   338                                 
   339 0000035A 48897C2408              mov [rsp+8], rdi
   340 0000035F 4889742410              mov [rsp+16], rsi
   341 00000364 4889542418              mov [rsp+24], rdx
   342 00000369 48894C2420              mov [rsp+32], rcx
   343 0000036E 4C89442428              mov [rsp+40], r8
   344 00000373 4C894C2430              mov [rsp+48], r9
   345 00000378 4C89542438              mov [rsp+56], r10
   346 0000037D 4C895C2440              mov [rsp+64], r11
   347                                 
   348 00000382 48C7C7[00000000]        mov rdi, print_pointer
   349 00000389 488B742408              mov rsi, [rsp+8]
   350 0000038E E8(F6FFFFFF)            call printf
   351                                 
   352 00000393 488B7C2408              mov rdi, [rsp+8]
   353 00000398 488B742410              mov rsi, [rsp+16]
   354 0000039D 488B542418              mov rdx, [rsp+24]
   355 000003A2 488B4C2420              mov rcx, [rsp+32]
   356 000003A7 4C8B442428              mov r8, [rsp+40]
   357 000003AC 4C8B4C2430              mov r9, [rsp+48]
   358 000003B1 4C8B542438              mov r10, [rsp+56]
   359 000003B6 4C8B5C2440              mov r11, [rsp+64]
   360                                 
   361 000003BB 4883C450                add rsp, 80
   362 000003BF 5D                      pop rbp
   363 000003C0 C3                      ret
   364                                 
   365                                 
   366                                 
   367                                 
   368                                 
   369                                 
   370                                 
